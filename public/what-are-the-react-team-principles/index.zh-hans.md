---
title: React 团队的原则是什么？
date: "2019-12-25"
spoiler: UI 先于 API。
cta: "react"
---

在我在 React 团队工作期间，我很幸运地看到了 [Jordan](https://twitter.com/jordwalke)、[Sebastian](https://twitter.com/sebmarkbage)、[Sophie](https://twitter.com/sophiebits) 和其他资深团队成员如何解决问题。在这篇文章中，我将我从他们那里学到的知识提炼成几个高级技术原则。这些原则并不是面面俱到的。这是我个人尝试将关于 React 团队如何运作的观察正式化——其他团队成员可能有不同的视角。

## UI 先于 API

每个抽象在大规模部署时都有其自身的怪癖。这些怪癖如何在用户界面中表现出来？你能从一个应用看出它是用某种抽象构建的吗？

抽象对用户体验有直接影响——使某些体验成为可能，延续某些体验，甚至使某些体验变得不可能。这就是为什么在设计 API 时，我们不从抽象本身开始。相反，我们从期望的用户体验开始，然后反向推导出抽象。

有时当我们反向推导时，我们意识到需要改变整个方法来实现正确的用户体验。如果我们从 API 开始，我们就看不到这一点。所以我们把 UI 放在 API 之前。

## 吸收复杂性

让 React 内部简单并不是目标。如果复杂性能让产品开发人员的代码更容易理解和修改，我们愿意让 React 内部变得复杂。

我们希望产品开发能够去中心化和协作。通常，这意味着我们承担了中心化的重担。React 不能被分割成小型、简单、松散耦合的模块，因为为了完成其工作，必须有 something 作为协调者。这就是 React。

通过提高抽象级别，我们使产品开发人员更强大。他们受益于整个系统具有某些可预测的属性。但这意味着我们引入的每个新的第 N+1 个功能都必须与所有 N 个现有功能良好配合。这就是为什么向 React 贡献新功能在设计和实现方面都如此困难。这就是为什么我们没有获得很多"核心"开源贡献。

我们吸收复杂性以阻止其渗入到产品代码中。

## 先黑科技，后惯用法

每个 API 都会创造新的限制。有时这些限制阻止人们提供令人愉悦的用户体验。我们提供逃生舱，以便人们在必要时可以绕过我们。

黑科技不能长期存在，因为它们很脆弱。产品开发人员必须选择是通过支持黑科技来承受维护成本，还是降低用户体验但移除黑科技。通常，用户体验会输——或者黑科技阻止了对其的进一步改进。

我们需要允许通过逃生舱使用黑科技，并观察人们实践中采用的黑科技。我们的工作是最终为以更好的用户体验为名而存在的黑科技提供惯用的解决方案。有时，一个解决方案可能需要数年时间。我们更喜欢灵活的黑科技，而不是固化一个糟糕的惯用法。

## 启用局部推理

在代码编辑器中你能做的事情并不多。你可以添加一些行或删除它们。或者复制粘贴一些东西。然而，许多抽象使这些基本操作变得困难。

例如，MVC 框架往往使删除渲染输出的某些部分变得不安全。这是因为父级会命令式地调用其子级方法（在删除子级后这些方法就不存在了）。相比之下，在 React 中，通常可以安全地删除渲染树中的代码行。这是一个胜利。

在设计 API 时，我们假设人们只对他们正在处理的代码片段有局部了解。当预期效果是局部的时，我们希望防止出现意外结果。例如，我们通常期望添加代码是安全的。我们期望删除和更改代码能够清楚地指出需要作为此更改一部分考虑的所有相关代码。我们不能在更改单个文件时假设对整个代码库的了解。

当做某事不安全时，我们希望开发人员尽早发现其更改的完整影响。警告、类型检查和开发工具可以提供帮助，但它们受到 API 设计的限制。如果 API 不够严格，局部推理是不可能的。例如，这就是为什么 `findDOMNode()` 不好。它需要全局了解。

## 渐进复杂性

一些框架选择在路上设置岔路口。它们提供两种做事的方式：一种简单的方式和一种强大的方式。简单的方式学习起来很好，但在某个时候你会碰壁。当这种情况发生时，你必须撤销过去的工作，并以不同的方式重新实现它。

我们更喜欢实现复杂的事情在结构上与实现简单的事情没有太大不同。例如，我们不提供单独的模板 DSL "用于简单情况"，因为它会在路上创建岔路口。我们愿意在入门障碍上妥协，如果我们认为您无论如何很快就会想要完整功能的机制。

有时，"简单方式"和"强大方式"是两个不同的框架。然后你也必须重写。如果我们能避免这种情况，那也很好。例如，添加服务器渲染是一种优化，在 React 中需要一些额外的努力，但不是完全重写。

## 控制损害

自上而下的工具（如代码预算）很重要。然而，从长远来看，我们的标准会滑坡，功能将在截止日期前发布，产品将不再维护。当我们不能依靠每个人都配合时，我们作为协调者的角色是控制损害。

如果某些 UI 代码缓慢或超出预算，我们需要尽可能减少其对加载时间和与 UI 其他部分交互的负面影响。理想情况下，开发人员应该只为他们使用的功能"付费"，用户应该只为他们交互的 UI "付费"。并发模式功能包括时间切片和选择性水合作用是解决这个问题的不同杠杆。

因为库代码开销相对稳定，但应用程序代码是无限的，所以我们倾向于关注控制应用程序代码中的损害，而不是库代码的固定成本。

## 相信理论

有时，我们知道一种方法是死胡同。也许它今天有效，但我们已经意识到其局限性，而这些局限性从根本上阻止我们实现理想的用户体验。一旦可行，我们就会尽快停止投资于这种方法。

我们希望避免陷入局部最大值。如果另一种方法在理论上更有意义，我们愿意投入努力去实现，即使这需要多年时间。将会有许多障碍和务实的妥协，我们可能不得不做出。但我们相信，如果我们不断突破它们，最终理论会胜利。

## 你的团队的原则是什么？

这些是我观察到的我们工作方式中的一些基本原则，但我可能遗漏了很多。我也没有涉及围绕我们如何推出 API、传达变更等的不太技术性的原则。这可能是另一天的话题。

你的团队有一套原则吗？我很想听听它们。

_本文最初发表于[这里](https://react.christmas/2019/24)。_
